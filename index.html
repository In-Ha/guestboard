<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ë¬¸ì˜ ê²Œì‹œíŒ</title>
<style>
  :root{
    --main:#0066ff;
    --bg:#f5f5f5;
    --text:#333;
    --radius:8px;
  }
  *{box-sizing:border-box}
  body{margin:0;padding:2rem;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;background:var(--bg);color:var(--text)}
  h1{text-align:center;margin:0 0 1rem 0;font-size:1.8rem}
  form#newPostForm{display:grid;gap:.75rem;max-width:860px;margin:0 auto 2rem auto;grid-template-columns:repeat(auto-fit,minmax(250px,1fr))}
  form#newPostForm input,form#newPostForm textarea{padding:.6rem .8rem;border:1px solid #ccc;border-radius:var(--radius);font-size:.95rem;width:100%}
  form#newPostForm textarea{grid-column:1/-1;min-height:120px;resize:vertical}
  form#newPostForm button{grid-column:1/-1;padding:.75rem;border:none;border-radius:var(--radius);background:var(--main);color:#fff;font-size:1rem;cursor:pointer}
  table{width:100%;max-width:860px;margin:0 auto;border-collapse:collapse;background:#fff;border-radius:var(--radius);overflow:hidden;box-shadow:0 2px 5px rgba(0,0,0,.05)}
  thead{background:#eaf1ff;font-weight:600}
  th,td{padding:.75rem;border-bottom:1px solid #ddd;text-align:left;line-height:1.4}
  tr.postRow{cursor:pointer}
  tr.postRow:hover{background:#f9fbff}
  tr.detailsRow td{padding:0;background:#fafafa}
  .detail-wrapper{padding:1rem;border-top:1px solid #ddd;position:relative}
  .blurred{filter:blur(6px)}
  .authArea{margin-top:1rem;display:flex;gap:.5rem;flex-wrap:wrap}
  .authArea input{flex:1 1 180px;padding:.5rem;border:1px solid #ccc;border-radius:var(--radius)}
  .authArea button{padding:.55rem 1rem;background:var(--main);color:#fff;border:none;border-radius:var(--radius);cursor:pointer}
  .actions{margin-top:1rem;display:none;gap:.5rem}
  .actions button{padding:.45rem .9rem;font-size:.9rem;background:#444;color:#fff;border:none;border-radius:var(--radius);cursor:pointer}
  .actions button.delete{background:#d32f2f}
  textarea.editArea{width:100%;min-height:120px;margin-top:.75rem;padding:.65rem;border:1px solid #bbb;border-radius:var(--radius)}
</style>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <h1>ë¬¸ì˜ ê²Œì‹œíŒ</h1>
  <form id="newPostForm">
    <input name="author" placeholder="ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" required />
    <input type="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸(ì‘ì„±ê¸€ ë° ëŒ“ê¸€ í™•ì¸ ì‹œ í•„ìš”í•©ë‹ˆë‹¤!)" required />
    <input name="title" placeholder="ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" required />
    <textarea name="content" required>ìƒì„¸ë‚´ìš©ì€ ì‘ì„±ì ë° ê´€ë¦¬ì ì™¸ì—ëŠ” ë¸”ëŸ¬ì²˜ë¦¬ë©ë‹ˆë‹¤.
ì—°ë½ì²˜:
í¬ë§ ìƒë‹´ì¼:
ìƒì„¸ ë‚´ìš©:</textarea>
    <button type="submit">ë“±ë¡</button>
  </form>

  <table>
    <thead>
      <tr><th style="width:60px">ë²ˆí˜¸</th><th>ë¬¸ì˜ì œëª©</th><th style="width:140px">ì‘ì„±ì</th><th style="width:170px">ì‘ì„±ì¼</th></tr>
    </thead>
    <tbody id="postsBody"></tbody>
  </table>

<script>
(function(){
  "use strict";

  /* --------------------
     ğŸ”‘ 1) Firebase ì„¤ì •
     í”„ë¡œì íŠ¸ ìƒì„± í›„ ì•„ë˜ ê°’ì„ ì‹¤ì œ í‚¤ë¡œ êµì²´í•˜ì„¸ìš”
     --------------------*/
  const firebaseConfig={
    apiKey:"YOUR_API_KEY",
    authDomain:"YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL:"https://YOUR_PROJECT_ID-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId:"YOUR_PROJECT_ID",
    storageBucket:"YOUR_PROJECT_ID.appspot.com",
    messagingSenderId:"SENDER_ID",
    appId:"APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db=firebase.database();
  const postsRef=db.ref("guest_posts");  // í…Œì´ë¸” ê°œë…

  /* -------------------- ìƒìˆ˜ --------------------*/
  const ADMIN_ID="plawjy";
  const ADMIN_PW="bmspjy88*";

  /* -------------------- DOM --------------------*/
  const bodyEl=document.getElementById("postsBody");
  const form=document.getElementById("newPostForm");

  /* -------------------- ìƒíƒœ --------------------*/
  let posts={}; // {id:postObj, ...}

  /* -------------------- ë Œë”ë§ --------------------*/
  function render(){
    bodyEl.innerHTML="";
    const list=Object.values(posts).sort((a,b)=>b.timestamp-a.timestamp);
    list.forEach((p,idx)=>{
      const row=document.createElement("tr");
      row.className="postRow";
      row.dataset.id=p.id;
      row.innerHTML=`<td>${list.length-idx}</td><td>${p.title}</td><td>${p.author}</td><td>${p.date}</td>`;
      bodyEl.appendChild(row);
    });
  }

  /* -------------------- ìƒì„¸í–‰ ìƒì„± --------------------*/
  function createDetailsRow(post){
    const det=document.createElement("tr");
    det.className="detailsRow";
    det.innerHTML=`<td colspan="4">
        <div class="detail-wrapper">
          <div class="contentArea blurred">${post.content.replace(/\n/g,"<br>")}</div>
          <div class="authArea">
            <input class="authName" placeholder="ì‘ì„±ìëª…"/>
            <input type="password" class="authPw" placeholder="ë¹„ë°€ë²ˆí˜¸"/>
            <button class="authBtn">í™•ì¸</button>
          </div>
          <div class="actions">
            <button class="edit">ìˆ˜ì •</button>
            <button class="delete">ì‚­ì œ</button>
          </div>
        </div>
      </td>`;
    return det;
  }

  /* -------------------- ê²Œì‹œê¸€ í´ë¦­ --------------------*/
  bodyEl.addEventListener("click",e=>{
    const row=e.target.closest("tr.postRow");
    if(!row)return;
    const id=row.dataset.id;

    // ì´ë¯¸ ì—´ë ¤ ìˆìœ¼ë©´ í† ê¸€
    if(row.nextSibling && row.nextSibling.classList.contains("detailsRow")){
      row.parentNode.removeChild(row.nextSibling);
      return;
    }

    const post=posts[id];
    const detRow=createDetailsRow(post);
    row.parentNode.insertBefore(detRow,row.nextSibling);

    const wrapper=detRow.querySelector(".detail-wrapper");
    const contentDiv=wrapper.querySelector(".contentArea");
    const nameIn=wrapper.querySelector(".authName");
    const pwIn=wrapper.querySelector(".authPw");
    const authBtn=wrapper.querySelector(".authBtn");
    const actions=wrapper.querySelector(".actions");

    function unlock(){
      contentDiv.classList.remove("blurred");
      actions.style.display="flex";
      wrapper.querySelector(".authArea").style.display="none";
    }

    authBtn.addEventListener("click",()=>{
      const name=nameIn.value.trim();
      const pw=pwIn.value;
      if((name===post.author && pw===post.password) || (name===ADMIN_ID && pw===ADMIN_PW)){
        unlock();
      }else{
        alert("ì‘ì„±ìëª… ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      }
    });

    /* -------- ì‚­ì œ --------*/
    actions.querySelector(".delete").addEventListener("click",()=>{
      if(!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))return;
      postsRef.child(post.id).remove();
    });

    /* -------- ìˆ˜ì • --------*/
    actions.querySelector(".edit").addEventListener("click",()=>{
      const editArea=document.createElement("textarea");
      editArea.className="editArea";
      editArea.value=post.content;
      contentDiv.replaceWith(editArea);
      actions.style.display="none";
      const saveBtn=document.createElement("button");
      saveBtn.textContent="ì €ì¥";
      saveBtn.style="margin-top:.75rem;padding:.5rem 1rem;background:var(--main);color:#fff;border:none;border-radius:var(--radius);cursor:pointer";
      editArea.after(saveBtn);
      saveBtn.addEventListener("click",()=>{
        postsRef.child(post.id).update({content:editArea.value});
      });
    });
  });

  /* -------------------- ìƒˆ ê¸€ ë“±ë¡ --------------------*/
  form.addEventListener("submit",e=>{
    e.preventDefault();
    const data=new FormData(form);
    const now=Date.now();
    const newPost={
      id:"", // push í›„ í‚¤ë¡œ ëŒ€ì²´
      author:data.get("author").trim(),
      password:data.get("password"),
      title:data.get("title").trim(),
      content:data.get("content").trim(),
      date:new Date(now).toLocaleString(),
      timestamp:now
    };
    const newRef=postsRef.push();
    newPost.id=newRef.key;
    newRef.set(newPost);
    form.reset();
  });

  /* -------------------- Firebase ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ --------------------*/
  postsRef.on("value",snapshot=>{
    posts=snapshot.val()||{};
    render();
  });
})();
</script>
</body>
</html>
